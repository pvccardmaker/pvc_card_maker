<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aadhaar PVC Converter + Text Bolder</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
<style>
* { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background:#f0f2f5; min-height:100vh; display:flex; justify-content:center; align-items:flex-start; padding:20px; margin:0; }
.container { background:white; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.2); width:100%; max-width:1000px; padding:30px; text-align:center; }
h2,h1 { margin-bottom:10px; }
.subtitle { text-align:center; color:#666; margin-bottom:30px; }

.card-container { width: 250px; height: 150px; margin: 20px auto; border:1px solid #ddd; padding:10px; display:flex; align-items:center; justify-content:center; background-size:cover; background-position:center; border-radius:8px; cursor:pointer; }

.loading-indicator { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:24px; font-weight:bold; display:none; color:#007bff; }
.error-message { color:red; }

.controls-box { padding:15px; background:#f1f5ff; border-left:4px solid #3660d6; border-radius:8px; margin-bottom:20px; }
.control-group { margin-bottom:15px; }
.control-label { font-weight:bold; margin-bottom:5px; display:block; }
.slider { width:100%; }

.preview-container { display:flex; justify-content:space-between; margin-top:30px; gap:20px; display:none; }
.preview-box { flex:1; border:1px solid #ddd; border-radius:8px; padding:15px; text-align:center; }
.preview-image { max-width:100%; max-height:300px; border-radius:5px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }

.download-container { text-align:center; margin-top:30px; display:none; }
.download-btn, .btn { cursor:pointer; }

.photo-selection { display:none; margin:20px 0; text-align:center; }
.photo-selection canvas { border:1px solid #ddd; border-radius:5px; max-width:100%; cursor:crosshair; }
.selection-controls { margin-top:10px; }
.selection-controls button { margin:0 5px; padding:8px 15px; border:none; border-radius:4px; font-size:14px; cursor:pointer; }
.clear-btn { background-color:#dc3545; color:white; }
.undo-btn { background-color:#ffc107; color:#212529; }
.confirm-btn { background-color:#28a745; color:white; }

.upload-area { border:2px dashed #4a90e2; border-radius:10px; padding:40px; text-align:center; margin-bottom:20px; background-color:#f8f9fa; }
.upload-icon { font-size:48px; color:#4a90e2; margin-bottom:15px; }
.upload-btn { background-color:#4a90e2; color:white; border:none; padding:10px 20px; border-radius:5px; font-size:16px; }
</style>
</head>
<body>

<div class="container">
<h2 class="text-primary">Aadhaar PVC Card Converter + Text Bolder</h2>
<p class="subtitle">Upload Aadhaar PDF/Image → Convert to PVC → Enhance text boldness/clarity</p>

<button type="button" class="btn btn-info" data-toggle="modal" data-target="#instructionsModal">Instructions</button>
<input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" class="form-control-file mt-3">
<button id="convertButton" class="btn btn-primary">Convert</button>
<div id="loadingIndicator" class="loading-indicator">Processing...</div>
<div id="errorMessage" class="error-message"></div>

<!-- PVC Cards Display -->
<div style="display:flex; justify-content:space-around; flex-wrap:wrap;">
    <div id="cardContainerLeft" class="card-container">Left PVC</div>
    <div id="cardContainerRight" class="card-container">Right PVC</div>
</div>
<div style="display:flex; justify-content:space-around; flex-wrap:wrap;">
    <a id="downloadLinkLeft" class="btn btn-success mt-3" style="display:none;">Download Left</a>
    <a id="downloadLinkRight" class="btn btn-success mt-3" style="display:none;">Download Right</a>
</div>

<!-- Boldness + Clarity -->
<div class="controls-box">
<div class="control-group">
<label class="control-label">Boldness (Thickness)</label>
<input type="range" id="boldnessSlider" min="0" max="2" step="0.1" value="0.5" class="slider">
<span id="boldnessValue"><b>0.5</b></span>
</div>
<div class="control-group">
<label class="control-label">Clarity (Contrast)</label>
<input type="range" id="claritySlider" min="0" max="100" value="30" class="slider">
<span id="clarityValue"><b>30</b></span>
</div>
</div>

<!-- Photo Selection -->
<div class="photo-selection" id="photoSelection">
<p>Select the passport photo by drawing a rectangle:</p>
<canvas id="photoCanvas"></canvas>
<div class="selection-controls">
<button id="clearSelectionBtn" class="clear-btn">Clear All</button>
<button id="undoSelectionBtn" class="undo-btn">Undo Last</button>
<button id="confirmSelectionBtn" class="confirm-btn">Confirm</button>
</div>
</div>

<div class="preview-container" id="previewContainer">
<div class="preview-box">
<div>Original PVC</div>
<img id="originalPreview" class="preview-image">
</div>
<div class="preview-box">
<div>Processed PVC</div>
<img id="processedPreview" class="preview-image">
</div>
</div>

<div class="download-container" id="downloadContainer">
<button class="download-btn" id="downloadBtn">Download Processed Image</button>
</div>

<canvas id="canvas" style="display:none;"></canvas>
</div>

<!-- Instructions Modal -->
<div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="instructionsModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title text-info" id="instructionsModalLabel">Instructions</h5>
<button type="button" class="close" data-dismiss="modal">&times;</button>
</div>
<div class="modal-body">
<p>1. Upload Aadhaar PDF/Image.</p>
<p>2. Convert to Left & Right PVC cards.</p>
<p>3. Click on Left or Right PVC card to select for enhancement.</p>
<p>4. Draw rectangle for passport photo if needed.</p>
<p>5. Adjust Boldness & Clarity sliders.</p>
<p>6. Download processed PVC cards.</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

<!-- Password Modal for PDF -->
<div class="modal fade" id="passwordModal" tabindex="-1" role="dialog" aria-labelledby="passwordModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title text-info">Enter Password</h5>
<button type="button" class="close" data-dismiss="modal">&times;</button>
</div>
<div class="modal-body">
<input type="password" id="passwordInput" class="form-control" placeholder="Enter password">
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
<button type="button" id="passwordSubmit" class="btn btn-primary">Submit</button>
</div>
</div>
</div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.worker.min.js';

// Sliders
const boldnessSlider=document.getElementById('boldnessSlider');
const claritySlider=document.getElementById('claritySlider');
const boldnessValue=document.getElementById('boldnessValue');
const clarityValue=document.getElementById('clarityValue');
boldnessSlider.oninput=()=>boldnessValue.innerHTML="<b>"+parseFloat(boldnessSlider.value).toFixed(1)+"</b>";
claritySlider.oninput=()=>clarityValue.innerHTML="<b>"+claritySlider.value+"</b>";

// Canvas & Photo selection
const photoSelection=document.getElementById('photoSelection');
const photoCanvas=document.getElementById('photoCanvas');
const photoCtx=photoCanvas.getContext('2d');
const previewContainer=document.getElementById('previewContainer');
const originalPreview=document.getElementById('originalPreview');
const processedPreview=document.getElementById('processedPreview');
const downloadContainer=document.getElementById('downloadContainer');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');

let pvcLeft=null, pvcRight=null, selectedPVC=null, photoAreas=[], isDrawing=false, startX,startY, processedImageData;

// PDF Unlock
async function unlockPDF(data,password){
try{return await pdfjsLib.getDocument({data,password}).promise;}
catch(e){if(e.name==='PasswordException') return null; throw e;}
}

// Convert Button
document.getElementById('convertButton').onclick=()=>{
const file=document.getElementById('fileInput').files[0];
if(!file){document.getElementById('errorMessage').innerHTML='Please upload a file first.'; return;}
if(file.type==='application/pdf'){
$('#passwordModal').modal('show');
document.getElementById('passwordSubmit').onclick=async()=>{
const password=document.getElementById('passwordInput').value;
if(!password){document.getElementById('errorMessage').innerHTML='Password required!'; return;}
const reader=new FileReader();
reader.readAsArrayBuffer(file);
reader.onload=async()=>{
try{
let pdfData=new Uint8Array(reader.result);
let pdf=await unlockPDF(pdfData,password);
if(pdf){
const page=await pdf.getPage(1);
const scale=4, viewport=page.getViewport({scale});
const tmpCanvas=document.createElement('canvas');
tmpCanvas.width=viewport.width; tmpCanvas.height=viewport.height;
await page.render({canvasContext:tmpCanvas.getContext('2d'),viewport}).promise;
processPVC(tmpCanvas.toDataURL('image/png'));
}else{document.getElementById('errorMessage').innerHTML='Invalid password';}
}catch(e){document.getElementById('errorMessage').innerHTML='Error:'+e.message;}
};
$('#passwordModal').modal('hide');
};
}else{
const reader=new FileReader();
reader.readAsDataURL(file);
reader.onload=e=>processPVC(e.target.result);
}
};

// Process PVC image and crop left/right
function processPVC(imageData){
const img=new Image();
img.onload=()=>{
const width=img.width, height=img.height, startX=200, bottomCropHeight=Math.ceil(height/3.6), bottomCropY=height-bottomCropHeight;

// Left PVC
const leftCanvas=document.createElement('canvas');
leftCanvas.width=Math.ceil(width/2.45); leftCanvas.height=bottomCropHeight/1.37;
const leftCtx=leftCanvas.getContext('2d');
leftCtx.drawImage(img,startX,bottomCropY+7,Math.ceil(width/2),bottomCropHeight,0,0,Math.ceil(width/2),bottomCropHeight);
pvcLeft=new Image(); pvcLeft.src=leftCanvas.toDataURL('image/png');

// Right PVC
const rightCanvas=document.createElement('canvas');
rightCanvas.width=Math.ceil(width/2.45); rightCanvas.height=bottomCropHeight/1.37;
const rightCtx=rightCanvas.getContext('2d');
rightCtx.drawImage(img,Math.ceil(width/2)+25,bottomCropY+5,Math.ceil(width/2),bottomCropHeight,0,0,Math.ceil(width/2),bottomCropHeight);
pvcRight=new Image(); pvcRight.src=rightCanvas.toDataURL('image/png');

// Show in containers
document.getElementById('cardContainerLeft').style.backgroundImage=`url(${pvcLeft.src})`;
document.getElementById('cardContainerRight').style.backgroundImage=`url(${pvcRight.src})`;
document.getElementById('downloadLinkLeft').href=pvcLeft.src;
document.getElementById('downloadLinkLeft').download='left_aadhaar_card.png';
document.getElementById('downloadLinkLeft').style.display='inline-block';
document.getElementById('downloadLinkRight').href=pvcRight.src;
document.getElementById('downloadLinkRight').download='right_aadhaar_card.png';
document.getElementById('downloadLinkRight').style.display='inline-block';

// Select left by default for enhancement
selectPVC('left');
};
img.src=imageData;
}

// PVC card selection
document.getElementById('cardContainerLeft').onclick=()=>selectPVC('left');
document.getElementById('cardContainerRight').onclick=()=>selectPVC('right');
function selectPVC(side){
selectedPVC=side==='left'?pvcLeft:pvcRight;
originalPreview.src=selectedPVC.src;
photoCanvas.width=selectedPVC.width; photoCanvas.height=selectedPVC.height;
photoCtx.drawImage(selectedPVC,0,0);
photoSelection.style.display='block';
photoAreas=[]; redrawCanvas();
}

// Photo Selection Drawing
photoCanvas.onmousedown=startDrawing; photoCanvas.onmousemove=draw; photoCanvas.onmouseup=endDrawing; photoCanvas.onmouseout=endDrawing;
document.getElementById('clearSelectionBtn').onclick=()=>{photoAreas=[]; redrawCanvas();};
document.getElementById('undoSelectionBtn').onclick=()=>{if(photoAreas.length>0){photoAreas.pop(); redrawCanvas();}};
document.getElementById('confirmSelectionBtn').onclick=()=>{if(photoAreas.length===0) return alert('Select at least one photo'); processImage();};
document.getElementById('downloadBtn').onclick=()=>{const a=document.createElement('a'); a.href=processedImageData; a.download='pvc-bold.png'; a.click();};

function startDrawing(e){isDrawing=true; const rect=photoCanvas.getBoundingClientRect(); startX=(e.clientX-rect.left)*(photoCanvas.width/rect.width); startY=(e.clientY-rect.top)*(photoCanvas.height/rect.height);}
function draw(e){if(!isDrawing) return; const rect=photoCanvas.getBoundingClientRect(); let x=(e.clientX-rect.left)*(photoCanvas.width/rect.width), y=(e.clientY-rect.top)*(photoCanvas.height/rect.height); redrawCanvas(); photoCtx.strokeStyle='red'; photoCtx.lineWidth=2; photoCtx.strokeRect(startX,startY,x-startX,y-startY);}
function endDrawing(e){if(!isDrawing) return; isDrawing=false; const rect=photoCanvas.getBoundingClientRect(); let x=(e.clientX-rect.left)*(photoCanvas.width/rect.width), y=(e.clientY-rect.top)*(photoCanvas.height/rect.height); photoAreas.push({x:Math.min(startX,x),y:Math.min(startY,y),width:Math.abs(x-startX),height:Math.abs(y-startY)}); redrawCanvas();}
function redrawCanvas(){photoCtx.clearRect(0,0,photoCanvas.width,photoCanvas.height); photoCtx.drawImage(selectedPVC,0,0); photoCtx.strokeStyle='red'; photoCtx.lineWidth=2; photoAreas.forEach(a=>photoCtx.strokeRect(a.x,a.y,a.width,a.height));}

// Boldness/Clarity Processing
function processImage(){
let boldness=parseFloat(boldnessSlider.value), clarity=parseInt(claritySlider.value);
canvas.width=photoCanvas.width; canvas.height=photoCanvas.height; ctx.drawImage(selectedPVC,0,0);
let imageData=ctx.getImageData(0,0,canvas.width,canvas.height), data=imageData.data;
let grayscale=[];
for(let i=0;i<data.length;i+=4){grayscale.push(0.299*data[i]+0.587*data[i+1]+0.114*data[i+2]);}
let avg=grayscale.reduce((a,b)=>a+b,0)/grayscale.length;
let threshold=avg*(0.85-clarity/100*0.5);
let mask=new Uint8ClampedArray(grayscale.length); for(let i=0;i<grayscale.length;i++){mask[i]=grayscale[i]<threshold?1:0;}
for(let area of photoAreas){for(let y=0;y<canvas.height;y++){for(let x=0;x<canvas.width;x++){if(x>=area.x && x<=area.x+area.width && y>=area.y && y<=area.y+area.height){mask[y*canvas.width+x]=0;}}}}
let dilationRadius=Math.round(boldness); mask=dilate(mask,canvas.width,canvas.height,dilationRadius);
for(let i=0;i<mask.length;i++){if(mask[i]===1){let px=i*4; data[px]*=0.3; data[px+1]*=0.3; data[px+2]*=0.3;}}
ctx.putImageData(imageData,0,0); processedImageData=canvas.toDataURL('image/png'); processedPreview.src=processedImageData; previewContainer.style.display='flex'; downloadContainer.style.display='block';
}
function dilate(mask,w,h,r){let out=new Uint8ClampedArray(mask.length); for(let y=0;y<h;y++){for(let x=0;x<w;x++){if(mask[y*w+x]===1){for(let dy=-r;dy<=r;dy++){for(let dx=-r;dx<=r;dx++){let nx=x+dx,ny=y+dy;if(nx>=0&&nx<w&&ny>=0&&ny<h){out[ny*w+nx]=1;}}}}}} return out;}
</script>

</body>
</html>
